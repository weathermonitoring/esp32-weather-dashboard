<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smart Door Notification</title>

<style>
  :root{
    --bg:#0b1020;
    --card:#121a33;
    --ok:#25d366;
    --bad:#ff4d4d;
    --warn:#ffb020;
    --txt:#e9eefc;
    --muted:#a9b4d6;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui,Segoe UI,Roboto,Arial;
    background: var(--bg);
    color:var(--txt);
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
  }
  .card{
    width:360px;
    background:var(--card);
    border-radius:18px;
    padding:22px;
    box-shadow:0 20px 50px rgba(0,0,0,.4);
    position:relative;
  }
  .bar{
    position:absolute;
    left:0;top:0;bottom:0;
    width:10px;
    border-radius:18px 0 0 18px;
    background:var(--warn);
  }
  h1{
    margin:0;
    font-size:18px;
    letter-spacing:.5px;
  }
  .state{
    font-size:48px;
    font-weight:800;
    margin:18px 0 6px;
  }
  .sub{
    color:var(--muted);
    font-size:14px;
  }
  .meta{
    margin-top:14px;
    font-size:12px;
    color:var(--muted);
  }
  .pill{
    position:absolute;
    top:14px;
    right:14px;
    font-size:12px;
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,.08);
  }

  /* Toast */
  .toast{
    position:fixed;
    bottom:18px;
    right:18px;
    background:#121a33;
    border-radius:14px;
    padding:14px 16px;
    box-shadow:0 16px 40px rgba(0,0,0,.45);
    opacity:0;
    transform:translateY(20px);
    transition:.25s ease;
  }
  .toast.show{
    opacity:1;
    transform:none;
  }
</style>
</head>

<body>

<div class="card">
  <div class="bar" id="bar"></div>
  <div class="pill" id="conn">Connectingâ€¦</div>
  <h1>SMART DOOR</h1>
  <div class="state" id="state">â€”</div>
  <div class="sub" id="sub">Waiting for dataâ€¦</div>
  <div class="meta" id="time">â€”</div>
</div>

<div class="toast" id="toast">
  <b id="toastTitle">Door Update</b>
  <div id="toastMsg" style="margin-top:6px;font-size:13px;color:#a9b4d6"></div>
</div>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
/* ================== FIXED CONNECTION ================== */
const MQTT_URL = "wss://1fd0a0a8829f48de9cd09299d2eaae06.s1.eu.hivemq.cloud:8884/mqtt";
const MQTT_USER = "hivemq.webclient.1764536797209";
const MQTT_PASS = "8mN37GwZr,Lc!u>$PJ1e";

const TOPIC_STATE = "smartdoor/state";
/* ===================================================== */

let lastState = null;

const el = id => document.getElementById(id);

const bar  = el("bar");
const stateEl = el("state");
const subEl   = el("sub");
const timeEl  = el("time");
const connEl  = el("conn");
const toast   = el("toast");
const toastMsg = el("toastMsg");

function now(){
  return new Date().toLocaleString();
}

function showToast(msg){
  toastMsg.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"), 3000);
}

function updateUI(state){
  stateEl.textContent = state;

  if(state === "OPEN"){
    bar.style.background = "var(--ok)";
    subEl.textContent = "Door opened â€” NOT secured";
    showToast("ðŸš¨ Door OPENED");
  }
  else if(state === "CLOSED"){
    bar.style.background = "var(--bad)";
    subEl.textContent = "Door closed â€” secured";
    showToast("âœ… Door CLOSED");
  }

  timeEl.textContent = "Last update: " + now();
}

/* ================== MQTT ================== */
const client = mqtt.connect(MQTT_URL,{
  username: MQTT_USER,
  password: MQTT_PASS,
  reconnectPeriod: 2000,
  connectTimeout: 8000
});

client.on("connect", ()=>{
  connEl.textContent = "Connected";
  client.subscribe(TOPIC_STATE);
});

client.on("reconnect", ()=>{
  connEl.textContent = "Reconnectingâ€¦";
});

client.on("close", ()=>{
  connEl.textContent = "Disconnected";
});

client.on("message",(topic,payload)=>{
  if(topic === TOPIC_STATE){
    const msg = payload.toString().trim().toUpperCase();
    if(msg !== lastState){
      updateUI(msg);
      lastState = msg;
    }
  }
});
</script>

</body>
</html>
